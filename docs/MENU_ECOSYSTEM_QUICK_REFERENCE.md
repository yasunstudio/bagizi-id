# ğŸ¯ MENU ECOSYSTEM - QUICK REFERENCE GUIDE

**Last Updated**: January 19, 2025

---

## ğŸ“Š MODEL RELATIONSHIP DIAGRAM (TEXT)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MENU ECOSYSTEM                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SPPG (Tenant)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                             â”‚
         â–¼                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NutritionProgram   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  SchoolBeneficiaryâ”‚
â”‚  (Context)         â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          â”‚            â”‚             â”‚            â”‚
         â–¼          â–¼            â–¼             â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚NutritionMenuâ”‚ â”‚ MenuPlan  â”‚ â”‚Productionâ”‚ â”‚Distributionâ”‚ â”‚Procurementâ”‚
â”‚  (Recipe)   â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚               â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚       â”‚               â”‚          â”‚
       â–¼       â–¼               â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Ingredientâ”‚â”‚RecipeStepâ”‚â”‚MenuAssignmentâ”‚â”‚FoodCategoryâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                      â”‚
       â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚InventoryItemâ”‚                      â”‚  Allergen    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼            â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MenuNutritionâ”‚ â”‚MenuCost  â”‚ â”‚Nutrition   â”‚
â”‚Calculation  â”‚ â”‚Calculationâ”‚ â”‚Standard    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ MODEL STATUS MATRIX

| Model | Schema | Seed | API | UI | Status |
|-------|--------|------|-----|----|---------
| **NutritionProgram** | âœ… | âœ… | âœ… | âœ… | ğŸŸ¢ Complete |
| **NutritionMenu** | âœ… | âœ… | âœ… | âœ… | ğŸŸ¢ Complete |
| **MenuIngredient** | âœ… | âœ… | âœ… | ğŸŸ¡ | ğŸŸ¡ Partial |
| **RecipeStep** | âœ… | âœ… | ğŸ”´ | ğŸ”´ | ğŸ”´ Missing UI |
| **MenuNutritionCalculation** | âœ… | âœ… | âœ… | âœ… | ğŸŸ¢ Complete |
| **MenuCostCalculation** | âœ… | âœ… | âœ… | ğŸŸ¡ | ğŸŸ¡ Partial |
| **MenuPlan** | âœ… | âœ… | ğŸŸ¡ | ğŸŸ¡ | ğŸŸ¡ Workflow Gap |
| **MenuAssignment** | âœ… | âœ… | âœ… | ğŸ”´ | ğŸ”´ No Calendar |
| **MenuPlanTemplate** | âœ… | âœ… | ğŸ”´ | ğŸ”´ | ğŸ”´ Not Implemented |
| **FoodCategory** | âœ… | âœ… | âœ… | âœ… | ğŸŸ¢ Complete (NEW) |
| **Allergen** | âœ… | âœ… | ğŸ”´ | ğŸ”´ | ğŸ”´ No Manager |
| **NutritionStandard** | âœ… | âœ… | âœ… | âœ… | ğŸŸ¢ Complete |

**Legend**:
- ğŸŸ¢ Complete = Fully functional
- ğŸŸ¡ Partial = Missing features
- ğŸ”´ Missing = Not implemented

---

## ğŸ”„ WORKFLOW STATUS

### **Menu Creation Workflow** âœ… COMPLETE
```
Create Program â†’ Create Menu â†’ Add Ingredients â†’ Add Recipe Steps â†’ Calculate Nutrition/Cost
    âœ…              âœ…             âœ…                  ğŸŸ¡                    âœ…
```

### **Menu Planning Workflow** ğŸŸ¡ PARTIAL
```
Create Plan â†’ Assign Menus â†’ Review â†’ Submit â†’ Approve â†’ Publish â†’ Generate Procurement
    âœ…            ğŸ”´           ğŸŸ¡       ğŸ”´       ğŸ”´        ğŸ”´            ğŸ”´
```

### **Production Workflow** âœ… COMPLETE
```
MenuPlan â†’ MenuAssignment â†’ Production â†’ Quality Control â†’ Distribution
    âœ…           âœ…              âœ…             âœ…                âœ…
```

---

## ğŸ“ SEED FILE DEPENDENCY TREE

```
1. sppg-seed.ts
   â””â”€â–¶ 2. user-seed.ts
       â””â”€â–¶ 3. program-seed.ts (creates NutritionProgram)
           â”œâ”€â–¶ 4. food-category-seed.ts (master data)
           â”œâ”€â–¶ 5. allergen-seed.ts (master data)
           â”œâ”€â–¶ 6. nutrition-seed.ts (standards)
           â”œâ”€â–¶ 7. inventory-seed.ts
           â”‚   â””â”€â–¶ 8. menu-seed.ts (creates NutritionMenu)
           â”‚       â”œâ”€â–¶ 9. menu-cost-nutrition-seed.ts (calculations)
           â”‚       â”œâ”€â–¶ 10. menu-plan-seed.ts (creates MenuPlan)
           â”‚       â”‚   â”œâ”€â–¶ 11. menu-assignment-testresult-seed.ts
           â”‚       â”‚   â””â”€â–¶ 12. menu-plan-template-seed.ts
           â”‚       â”œâ”€â–¶ 13. menu-research-seed.ts
           â”‚       â””â”€â–¶ 14. nutrition-menu-analysis-seed.ts
           â””â”€â–¶ 15. production-seed.ts
               â””â”€â–¶ 16. distribution-seed.ts
```

**Total Menu-Related Seed Files**: 14 files

---

## ğŸ¯ PRIORITY ACTION ITEMS

### **ğŸ”´ CRITICAL (Do This Week)**

1. **Menu Planning Approval Workflow**
   ```
   Priority: P0 (Blocker)
   Effort: 3 days
   APIs Needed:
   - POST /api/sppg/menu-plan/[id]/submit
   - POST /api/sppg/menu-plan/[id]/approve
   - POST /api/sppg/menu-plan/[id]/reject
   - POST /api/sppg/menu-plan/[id]/publish
   
   UI Needed:
   - Approval Panel Component
   - Status Timeline Component
   - Comment Thread Component
   ```

2. **Planning Calendar View**
   ```
   Priority: P0 (User Experience)
   Effort: 5 days
   Features:
   - Month/Week/Day views
   - Drag-drop menu assignment
   - Visual cost/nutrition indicators
   - Quick menu swap
   ```

---

### **ğŸŸ¡ HIGH (Next 2 Weeks)**

3. **Recipe Step Manager**
   ```
   Priority: P1 (Content Creation)
   Effort: 5 days
   Features:
   - Visual step editor
   - Drag-drop reordering
   - Image/video upload
   - Quality check notes
   ```

4. **Procurement Generation**
   ```
   Priority: P1 (Automation)
   Effort: 3 days
   API: POST /api/sppg/menu-plan/[id]/generate-procurement
   Algorithm:
   - Aggregate ingredients from all assignments
   - Calculate quantities based on portions
   - Group by preferred suppliers
   - Create linked ProcurementPlan
   ```

5. **Allergen Management**
   ```
   Priority: P1 (Data Management)
   Effort: 3 days
   Pages:
   - /settings/allergens (CRUD)
   - Improved allergen selector in MenuForm
   ```

---

### **ğŸŸ¢ MEDIUM (Next Month)**

6. **Menu Plan Templates**
7. **Nutrition Dashboard**
8. **Cost Analytics**
9. **Advanced Menu Filters**
10. **Menu Duplication/Import/Export**

---

## ğŸ“Š IMPLEMENTATION METRICS

### **Completion Percentage**

| Layer | Complete | In Progress | Not Started | Total |
|-------|----------|-------------|-------------|-------|
| **Schema** | 12 | 0 | 0 | 12 (100%) |
| **Seed** | 14 | 0 | 0 | 14 (100%) |
| **API** | 8 | 3 | 5 | 16 (50%) |
| **UI** | 6 | 4 | 6 | 16 (38%) |

### **Estimated Work Remaining**

```
Critical Priority (P0):  8 days
High Priority (P1):     18 days
Medium Priority (P2):   13 days
Low Priority (P3):      15 days
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL:                  54 days (~11 weeks)
```

### **Quick Wins Available**

```
âœ¨ Menu Duplication:          1 day
âœ¨ Menu Import/Export:         2 days
âœ¨ Menu Status Indicators:    1 day
âœ¨ Quick Menu Filters:        1 day
âœ¨ Menu Comparison:           2 days
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL QUICK WINS:             7 days
```

---

## ğŸ”— KEY API ENDPOINTS

### **âœ… Implemented**

```typescript
// Menu CRUD
GET    /api/sppg/menu              // List menus
POST   /api/sppg/menu              // Create menu
GET    /api/sppg/menu/[id]         // Get menu detail
PUT    /api/sppg/menu/[id]         // Update menu
DELETE /api/sppg/menu/[id]         // Delete menu

// Menu Relations
GET    /api/sppg/menu/[id]/ingredients  // Get ingredients
POST   /api/sppg/menu/[id]/ingredients  // Add ingredient
GET    /api/sppg/menu/[id]/nutrition    // Get nutrition calc
GET    /api/sppg/menu/[id]/cost         // Get cost calc

// Menu Plan CRUD
GET    /api/sppg/menu-plan         // List plans
POST   /api/sppg/menu-plan         // Create plan
GET    /api/sppg/menu-plan/[id]    // Get plan detail
PUT    /api/sppg/menu-plan/[id]    // Update plan
DELETE /api/sppg/menu-plan/[id]    // Delete plan

// Menu Plan Relations
GET    /api/sppg/menu-plan/[id]/assignments  // Get assignments
POST   /api/sppg/menu-plan/[id]/assignments  // Add assignment
```

### **ğŸ”´ Missing (High Priority)**

```typescript
// Workflow Actions
POST   /api/sppg/menu-plan/[id]/submit              // Submit for approval
POST   /api/sppg/menu-plan/[id]/approve             // Approve plan
POST   /api/sppg/menu-plan/[id]/reject              // Reject plan
POST   /api/sppg/menu-plan/[id]/publish             // Publish plan

// Procurement Integration
POST   /api/sppg/menu-plan/[id]/generate-procurement  // Generate procurement

// Recipe Management
GET    /api/sppg/menu/[id]/recipe-steps         // Get all steps
POST   /api/sppg/menu/[id]/recipe-steps         // Add step
PUT    /api/sppg/menu/[id]/recipe-steps/[step]  // Update step
DELETE /api/sppg/menu/[id]/recipe-steps/[step]  // Delete step

// Template Management
GET    /api/sppg/menu-plan-template             // List templates
POST   /api/sppg/menu-plan-template             // Create template
GET    /api/sppg/menu-plan-template/[id]        // Get template
DELETE /api/sppg/menu-plan-template/[id]        // Delete template

// Allergen Management
GET    /api/sppg/allergen                       // List allergens
POST   /api/sppg/allergen                       // Create custom allergen
PUT    /api/sppg/allergen/[id]                  // Update allergen
DELETE /api/sppg/allergen/[id]                  // Delete allergen
```

---

## ğŸ“ CURRENT POSITION

### **What's Working Well** âœ…
- Core menu management (create, edit, list, view)
- Ingredient linking to inventory
- Auto-calculation of nutrition and cost
- Program-based menu organization
- Food category classification (NEW)
- Basic menu planning

### **What's Blocking Progress** ğŸš§
1. **No approval workflow** - Plans stuck in draft
2. **No visual calendar** - Hard to see weekly/monthly plans
3. **No recipe editor** - Manual SQL editing required
4. **No procurement link** - Manual procurement creation
5. **No template system** - Repetitive planning work

### **Quick Assessment**
```
Foundation:     ğŸŸ¢ Solid (90%)
Core Features:  ğŸŸ¢ Good (75%)
Planning:       ğŸŸ¡ Basic (60%)
Workflow:       ğŸ”´ Missing (20%)
Automation:     ğŸ”´ Missing (10%)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
OVERALL:        ğŸŸ¡ 65% Complete
```

---

## ğŸ¯ RECOMMENDED SPRINT PLAN

### **Sprint 1: Workflow Foundation** (Week 1-2)
```
Goal: Enable complete planning workflow

â–¡ Implement approval APIs (3d)
â–¡ Build approval panel UI (3d)
â–¡ Create status timeline (2d)
â–¡ Add email notifications (2d)

Deliverable: Plans can be submitted and approved
```

### **Sprint 2: Visual Planning** (Week 3-4)
```
Goal: Better planning UX

â–¡ Build planning calendar (5d)
â–¡ Implement drag-drop (3d)
â–¡ Add quick actions (2d)

Deliverable: Visual drag-drop planning
```

### **Sprint 3: Automation** (Week 5-6)
```
Goal: Reduce manual work

â–¡ Procurement generation (3d)
â–¡ Template system (3d)
â–¡ Recipe manager (5d)

Deliverable: One-click operations
```

---

## ğŸ“š RELATED DOCUMENTATION

- `/docs/MENU_DOMAIN_COMPREHENSIVE_AUDIT.md` - This document
- `/docs/FOODCATEGORY_INTEGRATION_COMPLETE.md` - Food category implementation
- `/docs/MENU_PLANNING_CRITICAL_FIXES_COMPLETE.md` - Planning fixes
- `/docs/PROGRAM_DOMAIN_AUDIT_COMPLETE.md` - Program management

---

**Quick Reference Guide Complete** - January 19, 2025
